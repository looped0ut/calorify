<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Health Profile Setup</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ---------- RESET ---------- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* ---------- BODY ---------- */
body {
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* ---------- CONTAINER ---------- */
.container {
  width: 100%;
  max-width: 600px;
  background: #ffffff;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.25);
  position: relative;
}

/* ---------- PROGRESS ---------- */
.progress {
  font-size: 14px;
  color: #555;
  margin-bottom: 8px;
}

.progress-bar {
  height: 8px;
  background: #eee;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 25px;
}

#progressFill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #27ae60, #2ecc71);
  transition: width 0.4s ease;
}

/* ---------- QUESTIONS ---------- */
.question {
  display: none;
  text-align: center;
  animation: slideFade 0.4s ease forwards;
}

.question.active {
  display: block;
}

@keyframes slideFade {
  from {
    opacity: 0;
    transform: translateX(40px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.question h2 {
  margin-bottom: 12px;
}

.question p {
  color: #666;
  margin-bottom: 20px;
}

/* ---------- INPUTS ---------- */
input[type="number"],
input[type="text"],
select,
textarea {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 10px;
  border: 1px solid #ccc;
}

.radio-group,
.checkbox-group {
  text-align: left;
}

.radio-group label,
.checkbox-group label {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 14px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-bottom: 12px;
  cursor: pointer;
  transition: 0.3s;
}

.radio-group label:hover,
.checkbox-group label:hover {
  background: #f4f6f8;
}

/* ---------- BUTTONS ---------- */
.buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 30px;
}

button {
  padding: 14px 24px;
  font-size: 16px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
}

#prev-btn {
  background: #bdc3c7;
}

#next-btn {
  background: #27ae60;
  color: white;
}

#next-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>
</head>

<body>

<div class="container">

  <div class="progress" id="progress">Question 1 of 12</div>
  <div class="progress-bar">
    <div id="progressFill"></div>
  </div>

  <!-- QUESTIONS -->
  <div class="question active" data-key="age">
    <h2>Your Age</h2>
    <p>Enter your age in years</p>
    <input type="number" min="1" max="120">
  </div>

  <div class="question" data-key="gender">
    <h2>Gender</h2>
    <div class="radio-group">
      <label><input type="radio" name="gender" value="Male"> Male</label>
      <label><input type="radio" name="gender" value="Female"> Female</label>
      <label><input type="radio" name="gender" value="Other"> Other</label>
    </div>
  </div>

  <div class="question" data-key="height">
    <h2>Height (cm)</h2>
    <input type="number" min="50" max="250">
  </div>

  <div class="question" data-key="weight">
    <h2>Weight (kg)</h2>
    <input type="number" min="20" max="300">
  </div>

  <div class="question" data-key="activityLevel">
    <h2>Activity Level</h2>
    <div class="radio-group">
      <label><input type="radio" name="activity" value="Sedentary"> Sedentary</label>
      <label><input type="radio" name="activity" value="Moderate"> Moderate</label>
      <label><input type="radio" name="activity" value="Active"> Active</label>
      <label><input type="radio" name="activity" value="Very Active"> Very Active</label>
    </div>
  </div>

  <div class="question" data-key="dietaryGoal">
    <h2>Fitness Goal</h2>
    <div class="radio-group">
      <label><input type="radio" name="goal" value="Weight Loss"> Weight Loss</label>
      <label><input type="radio" name="goal" value="Maintenance"> Maintenance</label>
      <label><input type="radio" name="goal" value="Weight Gain"> Weight Gain</label>
    </div>
  </div>

  <div class="question" data-key="generalLifestyle">
    <h2>Lifestyle</h2>
    <div class="radio-group">
      <label><input type="radio" name="life" value="Sedentary"> Sedentary</label>
      <label><input type="radio" name="life" value="Balanced"> Balanced</label>
      <label><input type="radio" name="life" value="Active"> Active</label>
    </div>
  </div>

  <div class="question" data-key="dietaryPreference">
    <h2>Diet Preference</h2>
    <div class="radio-group">
      <label><input type="radio" name="diet" value="Vegetarian"> Vegetarian</label>
      <label><input type="radio" name="diet" value="Vegan"> Vegan</label>
      <label><input type="radio" name="diet" value="Non-Vegetarian"> Non-Vegetarian</label>
    </div>
  </div>

  <div class="question" data-key="healthBackground">
    <h2>Health Background</h2>
    <div class="checkbox-group">
      <label><input type="checkbox" value="Diabetes"> Diabetes</label>
      <label><input type="checkbox" value="BP"> Blood Pressure</label>
      <label><input type="checkbox" value="Thyroid"> Thyroid</label>
      <label><input type="checkbox" value="None"> None</label>
    </div>
  </div>

  <!-- BUTTONS -->
  <div class="buttons">
    <button id="prev-btn">Back</button>
    <button id="next-btn" disabled>Next</button>
  </div>

</div>

<script>
const questions = document.querySelectorAll(".question");
const nextBtn = document.getElementById("next-btn");
const prevBtn = document.getElementById("prev-btn");
const progressText = document.getElementById("progress");
const progressFill = document.getElementById("progressFill");

let current = 0;
const answers = {};

function showQuestion(i) {
  questions.forEach((q, index) => q.classList.toggle("active", index === i));
  progressText.innerText = `Question ${i + 1} of ${questions.length}`;
  progressFill.style.width = ((i + 1) / questions.length) * 100 + "%";
  validate();
}

function validate() {
  const inputs = questions[current].querySelectorAll("input");
  let valid = false;

  inputs.forEach(input => {
    if ((input.type === "radio" || input.type === "checkbox") && input.checked)
      valid = true;
    if (input.type !== "radio" && input.type !== "checkbox" && input.value)
      valid = true;
  });

  nextBtn.disabled = !valid;
}

function saveAnswer() {
  const q = questions[current];
  const key = q.dataset.key;
  const inputs = q.querySelectorAll("input");
  let values = [];

  inputs.forEach(i => {
    if ((i.type === "radio" || i.type === "checkbox") && i.checked)
      values.push(i.value);
    else if (i.type !== "radio" && i.type !== "checkbox" && i.value)
      values.push(i.value);
  });

  answers[key] = values.length === 1 ? values[0] : values;
}

nextBtn.onclick = () => {
  saveAnswer();
  current++;
  if (current < questions.length) {
    showQuestion(current);
  } else {
    const user = JSON.parse(localStorage.getItem("currentUser"));

fetch("http://localhost:3000/profile", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    user_id: user.id,
    age: answers.age,
    gender: answers.gender,
    height: answers.height,
    weight: answers.weight,
    activityLevel: answers.activityLevel,
    dietaryGoal: answers.dietaryGoal,
    generalLifestyle: answers.generalLifestyle,
    dietaryPreference: answers.dietaryPreference,
    healthBackground: Array.isArray(answers.healthBackground)
      ? answers.healthBackground.join(", ")
      : answers.healthBackground
  })
})
.then(() => {
  window.location.href = "../dashboard/dashboard.html";
});

  }
};

prevBtn.onclick = () => {
  if (current > 0) {
    current--;
    showQuestion(current);
  }
};

document.addEventListener("input", validate);

showQuestion(current);
</script>

</body>
</html>
